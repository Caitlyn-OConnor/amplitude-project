id: amplitude
namespace: des.team

tasks:
  - id: wdir
    type: io.kestra.plugin.core.flow.WorkingDirectory
    tasks:
      - id: hello
        type: io.kestra.plugin.core.log.Log
        message: Hello World! üöÄ

      - id: clone
        type: io.kestra.plugin.git.Clone
        url: https://github.com/Caitlyn-OConnor/amplitude-project
        branch: main
        username: "{{ kv('github_user')}}"
        password: "{{ kv('github_token')}}"

      - id: git_python_scripts
        type: io.kestra.plugin.scripts.python.Commands
        env:
          AWS_ACCESS_KEY: "{{ kv('AWS_ACCESS_KEY') }}"
          AWS_SECRET_KEY: "{{ kv('AWS_SECRET_KEY') }}"
          AWS_BUCKET_NAME: "{{ kv('AWS_BUCKET_NAME') }}"
          AMP_API_KEY: "{{ kv('AMP_API_KEY') }}"
          AMP_SECRET_KEY: "{{ kv('AMP_SECRET_KEY') }}"
        beforeCommands:
          - pip install -r amplitude/requirements.txt
        commands:
          - echo "packages installed ‚ï∞(*¬∞‚ñΩ¬∞*)‚ïØ, starting main python script üêç"
          - python amplitude/extract_amplitude.py
          - python amplitude/load_amplitude.py

# triggers:
#   - id: every_15_minutes
#     type: io.kestra.plugin.core.trigger.Schedule
#     cron: "*/15 * * * *"
